<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>附近大眾運輸</title>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css'
        integrity='sha512-SbiR/eusphKoMVVXysTKG/7VseWii+Y3FdHrt0EpKgpToZeemhqHeZeLWLhJutz/2ut2Vw1uQEj2MbRF+TVBUA=='
        crossorigin='anonymous' />
    <link rel='stylesheet'
        href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.3/font/bootstrap-icons.min.css'
        integrity='sha512-YFENbnqHbCRmJt5d+9lHimyEMt8LKSNTMLSaHjvsclnZGICeY/0KYEeiHwD1Ux4Tcao0h60tdcMv+0GljvWyHg=='
        crossorigin='anonymous' />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.79.0/L.Control.Locate.css" integrity="sha512-6+fQwheLeCW6sKV5liSHZ0rxcrN4TRBwWOhsof+3Iahu9J+WRyF4eBLjL5QshWxja6WiKE1WAtrH0hsRJ3nA8A==" crossorigin="anonymous" referrerpolicy="no-referrer" />


    <style>
        #map {
            height: 500px
        }
    </style>
</head>

<body class="m-3">

    <div id="map">
        <div style="display: flex;align-items: center;justify-content: center;text-align: center;height: 100%;">
            <div id="OSM-loading" style="text-align: center;"><h4>OpenStreetMap</h4>正在取得你的位置資訊...</div>
        </div>
    </div>
<p></p>
    <div class="d-flex">
        <input type="text" name="" id="lng" class="form-control me-1" style="width:fit-content" placeholder="經度">
   
        <input type="text" name="" id="lat" class="form-control me-1" style="width:fit-content" placeholder="緯度">
        
    </div>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js'
        integrity='sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=='
        crossorigin='anonymous'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.js'
        integrity='sha512-L6XANV6sOsx9N9c787eDN1pjB2Pzautd3xDgn4cMKuoleHSuCJi5pCDGPCtwE3Bd4A1Olnr0k0aQXbczYzg+wg=='
        crossorigin='anonymous'></script>

    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.79.0/L.Control.Locate.min.js" integrity="sha512-mq6Ep7oDFiumX+lUJle/srDcLqY512R6Yney/E3u3sZZO7T+UgoizxPmAauxoc5qERfMVMcHVITQYf6eKmtjtw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  
    <script>
        // 跟使用者要位置 
    
            
        function successGPS(position) {
            $("#OSM-loading").html("<h4>OpenStreetMap</h4>地圖載入中...")
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            center = [lat, lng];
            $("#lat").val(lat);$("#lng").val(lng)
            let zoom = 17; // 0 - 18
            var map = L.map('map').setView(center, zoom);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap', 
                zoomControl: true, // 是否秀出 - + 按鈕
            }).addTo(map);
            const customIcon = L.icon({
                // iconUrl: 'D:/html/Bus/geo-alt-fill.svg',
                iconSize: [42, 42],
            });
            const marker = L.marker(center, {
                //       icon: customIcon,
                opacity: 1.0
            }).addTo(map);
            marker.bindPopup("<b>你的目前位置</b><br>定位可能有誤差").openPopup();

            map.zoomIn(18);
            const popup = L.popup();
            function onMapClick(e) {
                console.log(e)
                let lat = e.latlng.lat; // 緯度
                let lng = e.latlng.lng; // 經度
                popup.setLatLng(e.latlng).setContent(`緯度：${lat}<br/>經度：${lng}`).openOn(map);
                $("#lat").val(lat);$("#lng").val(lng)
            }
            map.on('click', onMapClick);

        };
        function errorGPS() {
  
            // 接著寫使用者「封鎖」位置資訊請求後要執行的事
            $("#OSM-loading").html(`<h4>OpenStreetMap</h4>請允許使用位置資訊<p><buton class="btn btn-primary" onclick=" $('#OSM-loading').html('<h4>OpenStreetMap</h4>正在取得你的位置資訊...');navigator.geolocation.getCurrentPosition(successGPS, errorGPS);">重新定位</button></p>`)
 
        }

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(successGPS, errorGPS);
        } else {

            $("#OSM-loading").html("<h4>OpenStreetMap</h4>你的裝置無法使用位置資訊")
            // 接著寫使用者裝置不支援位置資訊時要執行的事
        }


    </script>

</body>

</html>