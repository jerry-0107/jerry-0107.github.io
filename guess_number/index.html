<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>猜數字0000-9999</title>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css'
        integrity='sha512-SbiR/eusphKoMVVXysTKG/7VseWii+Y3FdHrt0EpKgpToZeemhqHeZeLWLhJutz/2ut2Vw1uQEj2MbRF+TVBUA=='
        crossorigin='anonymous' />
    <link rel='stylesheet'
        href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.3/font/bootstrap-icons.min.css'
        integrity='sha512-YFENbnqHbCRmJt5d+9lHimyEMt8LKSNTMLSaHjvsclnZGICeY/0KYEeiHwD1Ux4Tcao0h60tdcMv+0GljvWyHg=='
        crossorigin='anonymous' />
    <style>

    </style>
</head>

<body class="m-3">
    <h2>輸入</h2>
    <div class="d-flex mb-1">
        
        <input id="input" type="number" class="me-1 form-control" style="width: fit-content " placeholder="輸入數字"
        
        oninput="checknum()"
        onblur="chechnum()"
        onfocus="checknum()">

        <div class="btn-group me-1" role="group">
            <input type="radio" class="btn-check" name="btnradio" id="success">
            <label class="btn btn-outline-success" for="success">成功</label>

            <input type="radio" class="btn-check" name="btnradio" id="failed" checked>
            <label class="btn btn-outline-secondary" for="failed">失敗</label>
        </div>
        <button class="btn btn-success me-1" onclick="addnum()">新增</button>
        <button class="btn btn-primary me-1" onclick="getnum()">建議+新增現有</button>
    </div>
    <p><span id="search">輸入數字以搜尋...</span></p>
    <p>共猜了<span id="total" class="badge text-bg-primary">N/A</span>個數字 猜中了<span id="success-total" class="badge text-bg-success">N/A</span>個數字
        

    <div class="progress" style="height: 16px;" >
        <div class="progress-bar" role="progressbar" id="prog1" style="width: 0%;"
            aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            <span id="percent">N/A</span>
        </div>
    </div>
    </p>


    <h2>輸出</h2>
    <ul class="list-group" id="output" data-count="0" style="max-height: 370px;
    overflow-y: scroll;"></ul>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js'
        integrity='sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=='
        crossorigin='anonymous'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.min.js'
        integrity='sha512-1/RvZTcCDEUjY/CypiMz+iqqtaoQfAITmNSJY17Myp4Ms5mdxPS5UV7iOfdZoxcGhzFbOm6sntTKJppjvuhg4g=='
        crossorigin='anonymous'></script>

    <script>
        /*
        number:[]
        success:[]
        
        */
        var number_data, success_data;
        if (localStorage.getItem("rnum")) {
            number_data = JSON.parse(localStorage.getItem("rnum")).number
            success_data = JSON.parse(localStorage.getItem("rnum")).success
            for (let i = 0; i < number_data.length; i++) {
                if (success_data.includes(number_data[i])) {
                    $("#output").append(`<li class="list-group-item text-bg-success" data-type="success">${number_data[i]}</li>`)
                } else {
                    $("#output").append(`<li class="list-group-item bg-secondary" data-type="failed">${number_data[i]}</li>`)
                }
            }
            $("#total").text(number_data.length)
            $("#percent").text((number_data.length / 10000) * 100)

            $("#success-total").text(success_data.length)
          

            $("#prog1").css("width",(number_data.length / 10000) * 100+"%").attr("aria-valuenow",(number_data.length / 10000) * 100)
        } else {
            localStorage.setItem("rnum", JSON.stringify({ number: [], success: [] }))
        }

        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        function IfStrIsBlank(str) {
            let _arr = str.split(" ")
            for (i = 0; i < _arr.length; i++) {

                if (_arr[i] !== " " && _arr[i] !== "") {
                    return false
                }
            }

            return true
        }

        function addnum() {
            if (!number_data.includes($("#input").val())) {

                if (!document.getElementById("success").checked) {
                    $("#output").append(`<li class="list-group-item bg-secondary" data-type="failed">${$("#input").val()}</li>`)
                } else {
                    $("#output").append(`<li class="list-group-item text-bg-success" data-type="success">${$("#input").val()}</li>`)
                    success_data.push($("#input").val())
                }

                number_data.push($("#input").val())
                localStorage.setItem("rnum", JSON.stringify({ "number": number_data, "success": success_data }))

                $("#total").text(number_data.length)
                $("#percent").text((number_data.length / 10000) * 100)
                $("#prog1").css("width",(number_data.length / 10000) * 100+"%").attr("aria-valuenow",(number_data.length / 10000) * 100)

                $("#success-total").text(success_data.length)
              
            } else {
                alert("數字重複!")
            }
            checknum()
        }
        function getnum() {
            if($("#input").val()!==""){
                addnum()
            }

            var n = getRandomInt(0, 9999),
                result = 1;
            while (result == 0) {
                if (number_data.includes(n) || number_data.includes(n.toString())) {
                    result = 0
                } else {
                    n = getRandomInt(0, 9999)
                }
            }
            $("#input").val(n)
            checknum()
        }

        function checknum(){
            n = $("#input").val()
            if(number_data.includes(n) || number_data.includes(n.toString())){
                if(success_data.includes(n)){
                    $("#search").html(`<i class="bi bi-check-circle-fill text-success"></i> ${n} - 數字已經存在 (成功)`)
                }else{
                    $("#search").html(`<i class="bi bi-x-circle-fill text-secondary"></i> ${n} - 數字已經存在 (失敗)`)
                }
            }else{
                $("#search").html(`<i class="bi bi-app text-primary"></i> ${n} - 數字不存在`)
            }
        }
    </script>
</body>

</html>